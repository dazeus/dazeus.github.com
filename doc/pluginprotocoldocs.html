<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>DaZeus: DaZeus 2 Plugin Protocol</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DaZeus&#160;<span id="projectnumber">2.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('pluginprotocoldocs.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="class_da_zeus.html">DaZeus</a> 2 Plugin Protocol </div>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="Introduction"></a>
Introduction</h2>
<p>The <a class="el" href="class_da_zeus.html">DaZeus</a> 2 plugin protocol links the core bot with the installed plugins, and is used to communicate events and their responses. Also, it exposes DaZeus' own configuration and database APIs, so plugins can easily attach without requiring configuration of their own.</p>
<p>Bindings for this protocol are available for several languages. Of course, patches are very welcome for newly implemented bindings! For help with writing bindings, you can look at the logic in existing bindings -- see the main page of this documentation to find their source code. Also, to experiment with the protocol without the use of special libraries, the <code>socat</code> or <code>nc</code> tool can be used as follows, where <code>dazeus.sock</code> is the UNIX socket:</p>
<ul>
<li><code>socat UNIX-CONNECT:dazeus.sock READLINE</code><br/>
</li>
<li><code>nc -U dazeus.sock</code></li>
</ul>
<p>The protocol was designed as a trade-off between human and machine readability. It is largely based on <a href="http://www.json.org">the JSON standard (http://www.json.org/)</a>, with some additions to allow for quicker reading. At the moment, communication is supported over UNIX and TCP sockets.</p>
<h2><a class="anchor" id="Overview"></a>
Overview</h2>
<p>Messages in the protocol look like this: </p>
<div class="fragment"><pre class="fragment">  [size in ASCII][JSON data of given size]
</pre></div><p>For example, a simple message might look like this: </p>
<div class="fragment"><pre class="fragment">  18{<span class="stringliteral">&quot;get&quot;</span>:<span class="stringliteral">&quot;networks&quot;</span>}
</pre></div><p>Here, the 18 is sent over the network as normal ASCII bytes, i.e. <code>0x31 0x38</code>. Reading a size stops at the first <code>{</code>. In order to improve human write- and readability, a <code>\n</code> (newline) or <code>\r</code> (carriage return) occuring anywhere outside of this atomic block is ignored. For example, the above message is equal to this:</p>
<div class="fragment"><pre class="fragment">  \n\r18{<span class="stringliteral">&quot;get&quot;</span>:<span class="stringliteral">&quot;networks&quot;</span>}\n\r
</pre></div><p>Any other bytes before the JSON, other than <code>\n</code>, <code>\r</code> and ASCII digits, are not allowed. The sender must not send them, the receiver must ignore them or abort the session.</p>
<p>The bot will respond to incoming messages in the order the messages were sent, with the exception that if the plugin is subscribed to events, those events may be sent in the middle of a list of responses. For example, communication like this is possible: </p>
<div class="fragment"><pre class="fragment">  Plugin: [Request 1]
  Plugin: [Request 2]
  Bot: [Response 1]
  Bot: [Event]
  Bot: [Response 2]
</pre></div><p>All JSON data must be objects. Requests will have a <code>get</code> or <code>do</code> field (both are synonyms) and may have a <code>params</code> field; responses will have a <code>got</code> or <code>did</code> field, a <code>success</code> field, and other fields depending on the request. If the <code>success</code> field value is false, there will be an <code>error</code> field with a human readable error string.</p>
<p>Events will have an <code>event</code> field and some <code>params</code>, that depend on the event (see the <a class="el" href="pluginprotocoldocs.html#Events">events section</a>).</p>
<h2><a class="anchor" id="Requests"></a>
Requests</h2>
<p>There are three types of requests:</p>
<ul>
<li>Get some information, like known networks or joined channels,</li>
<li>Do something on IRC, such as saying something or leaving a channel,</li>
<li>Accessing <a class="el" href="class_da_zeus.html">DaZeus</a> internals, such as events or the database.</li>
</ul>
<p>The "get all known networks" request looks like <code>{"get":"networks"}</code>. The response will have the list of networks in the <code>networks</code> field. The "get all joined channels" request will look like <code>{"get":"channels", "params":["the network"]}</code>. If the network is joined, the response will have a <code>channels</code> field with an array value. There is a similar <code>nick</code> command which retrieves our own nickname on a given network.</p>
<p>A message request will look like: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;network&quot;</span>,<span class="stringliteral">&quot;channel&quot;</span>,<span class="stringliteral">&quot;message&quot;</span>]}
</pre></div><p>For a CTCP ACTION (/me), use <code>action</code> instead of the first <code>message</code>: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;network&quot;</span>,<span class="stringliteral">&quot;channel&quot;</span>,<span class="stringliteral">&quot;message&quot;</span>]}
</pre></div><p>For joining a channel: (same for leaving a channel) </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;join&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;network&quot;</span>,<span class="stringliteral">&quot;channel&quot;</span>]}
</pre></div><p>For doing a WHOIS request: (the results come in through NUMERIC events, see the <a class="el" href="pluginprotocoldocs.html#Events">events section</a>) </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;whois&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;network&quot;</span>,<span class="stringliteral">&quot;nick&quot;</span>]}
</pre></div><p>The "subscribe to events" request will look like: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;subscribe&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;JOINED&quot;</span>,<span class="stringliteral">&quot;MOTD&quot;</span>]}
</pre></div><p> To unsubscribe, change <code>subscribe</code> into <code>unsubscribe</code>. See the next section for more information.</p>
<p>For all database actions, the action keyword is <code>property</code>, and the specific action is in the first parameter. For example, to retrieve the <code>count</code> property, the <code>counter</code> example Perl script sends: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;get&quot;</span>,<span class="stringliteral">&quot;examples.counter.count&quot;</span>]}
</pre></div><p> To set the value: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;set&quot;</span>,<span class="stringliteral">&quot;examples.counter.count&quot;</span>,<span class="stringliteral">&quot;2&quot;</span>]}
</pre></div><p> See the <a class="el" href="pluginprotocoldocs.html#Properties">section on properties</a> below for more information.</p>
<h2><a class="anchor" id="Events"></a>
Events</h2>
<p>After subscribing, events can be received anytime outside another existing response. The following events exist:</p>
<div class="fragment"><pre class="fragment">  CONNECT, DISCONNECT, JOIN, PART, QUIT, NICK, MODE, TOPIC, INVITE, KICK,
  PRIVMSG, NOTICE, CTCP, CTCP_REP, ACTION, NUMERIC, UNKNOWN, WHOIS, NAMES,
  PRIVMSG_ME, CTCP_ME, ACTION_ME, PONG
</pre></div><p>All events will have have an <code>event</code> field set to one of the above strings, and a <code>params</code> field that will contain an array with parameters depending on the event.</p>
<h2><a class="anchor" id="Properties"></a>
Properties</h2>
<p>Properties can be sent and retrieved over the <a class="el" href="class_da_zeus.html">DaZeus</a> 2 plugin protocol and act as a database for zero-configuration plugins. Using the <code>property set</code> command a property can be stored: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;set&quot;</span>,<span class="stringliteral">&quot;examples.counter.count&quot;</span>,<span class="stringliteral">&quot;2&quot;</span>]}
</pre></div><p>After this, the property can be retrieved using <code>property get</code>: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;get&quot;</span>,<span class="stringliteral">&quot;examples.counter.count&quot;</span>]}
</pre></div><p>This will result in the following response, after the previous two commands: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;variable&quot;</span>:<span class="stringliteral">&quot;examples.counter.count&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>:<span class="stringliteral">&quot;2&quot;</span>}
</pre></div><p>Next to these commands, <code>property unset</code> is available which looks like this: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;unset&quot;</span>,<span class="stringliteral">&quot;examples.counter.count&quot;</span>]}
</pre></div><p>Last but not least there is the <code>property keys</code> command, which returns a list of keys in a given namespace: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;keys&quot;</span>,<span class="stringliteral">&quot;examples.counter&quot;</span>]}
</pre></div><p> Which could respond: </p>
<div class="fragment"><pre class="fragment">  {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;keys&quot;</span>:[<span class="stringliteral">&quot;count&quot;</span>]}
</pre></div><p>For added functionality, you can look into variable scopes. Using the commands above, variables will be stored and returned "as is" (global scope). But, suppose you want to have a variable especially for a specific IRC channel, or even a specific user. You could use various different names per variable, but scoping allows you to let <a class="el" href="class_da_zeus.html">DaZeus</a> do the work for you.</p>
<p>There are four scopes, in order of specificity: Global scope, network scope, receiver scope and sender scope. When returning the variable, the `closest' variable is returned. For example, if a variable is set on global scope, and overridden on a network scope, variable requests with the same network will return the network scope value; all other requests will return the global scope value.</p>
<p>Scope is given through the <code>scope</code> array field on <code>property</code> requests. Some examples follow: </p>
<div class="fragment"><pre class="fragment">&gt; {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;set&quot;</span>,<span class="stringliteral">&quot;examples.scope.foo&quot;</span>, <span class="stringliteral">&quot;bar&quot;</span>]}
&lt; {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>:<span class="keyword">true</span>}
&gt; {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;scope&quot;</span>:[<span class="stringliteral">&quot;oftc&quot;</span>], <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;set&quot;</span>,<span class="stringliteral">&quot;examples.scope.foo&quot;</span>, <span class="stringliteral">&quot;baz&quot;</span>]}
&lt; {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>:<span class="keyword">true</span>}

&gt; {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;scope&quot;</span>:[<span class="stringliteral">&quot;q&quot;</span>], <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;get&quot;</span>,<span class="stringliteral">&quot;examples.scope.foo&quot;</span>]}
&lt; {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>:<span class="keyword">true</span>, <span class="stringliteral">&quot;variable&quot;</span>:<span class="stringliteral">&quot;examples.scope.foo&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>:<span class="stringliteral">&quot;bar&quot;</span>}
&gt; {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;scope&quot;</span>:[<span class="stringliteral">&quot;oftc&quot;</span>], <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;get&quot;</span>,<span class="stringliteral">&quot;examples.scope.foo&quot;</span>]}
&lt; {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>:<span class="keyword">true</span>, <span class="stringliteral">&quot;variable&quot;</span>:<span class="stringliteral">&quot;examples.scope.foo&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>:<span class="stringliteral">&quot;baz&quot;</span>}

&gt; {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;scope&quot;</span>:[<span class="stringliteral">&quot;oftc&quot;</span>], <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;unset&quot;</span>,<span class="stringliteral">&quot;examples.scope.foo&quot;</span>]}
&lt; {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>:<span class="keyword">true</span>}
&gt; {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;scope&quot;</span>:[<span class="stringliteral">&quot;oftc&quot;</span>], <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;get&quot;</span>,<span class="stringliteral">&quot;examples.scope.foo&quot;</span>]}
&lt; {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>:<span class="keyword">true</span>, <span class="stringliteral">&quot;variable&quot;</span>:<span class="stringliteral">&quot;examples.scope.foo&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>:<span class="stringliteral">&quot;bar&quot;</span>}
&gt; {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;unset&quot;</span>,<span class="stringliteral">&quot;examples.scope.foo&quot;</span>]}
&lt; {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>:<span class="keyword">true</span>}

&gt; {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;scope&quot;</span>:[<span class="stringliteral">&quot;oftc&quot;</span>], <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;set&quot;</span>,<span class="stringliteral">&quot;examples.scope.foo&quot;</span>, <span class="stringliteral">&quot;baz&quot;</span>]}
&lt; {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>:<span class="keyword">true</span>}
&gt; {<span class="stringliteral">&quot;do&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;scope&quot;</span>:[<span class="stringliteral">&quot;q&quot;</span>], <span class="stringliteral">&quot;params&quot;</span>:[<span class="stringliteral">&quot;get&quot;</span>,<span class="stringliteral">&quot;examples.scope.foo&quot;</span>]}
&lt; {<span class="stringliteral">&quot;did&quot;</span>:<span class="stringliteral">&quot;property&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>:<span class="keyword">true</span>, <span class="stringliteral">&quot;variable&quot;</span>:<span class="stringliteral">&quot;examples.scope.foo&quot;</span>}
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Wed Jan 30 2013 04:30:24 for DaZeus by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
